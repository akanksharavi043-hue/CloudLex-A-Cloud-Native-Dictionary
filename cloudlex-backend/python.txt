import json
import boto3

# Initialize DynamoDB resource
dynamodb = boto3.resource('dynamodb')

TABLE_NAME = "CloudLexTerms"

table = dynamodb.Table(TABLE_NAME)


def lambda_handler(event, context):
    # extracting query parameter
    params = event.get("queryStringParameters") or {}
    term = params.get("term")

    if not term:
        return response(
            400,
            {"message": "Query parameter 'term' is required"}
        )

    # normalizing input
    normalized_term = term.strip().lower()

    try:
        # fetch item from DynamoDB
        result = table.get_item(
            Key={"term": normalized_term}
        )

        # handling not found
        if "Item" not in result:
            return response(
                404,
                {"message": f"Term '{normalized_term}' not found"}
            )

        # success response
        return response(200, result["Item"])

    except Exception as e:
        return response(
            500,
            {"message": "Internal server error", "error": str(e)}
        )


def response(status_code, body):
    return {
        "statusCode": status_code,
        "headers": {
            "Content-Type": "application/json",
            "Access-Control-Allow-Origin": "*"
        },
        "body": json.dumps(body)
    }
